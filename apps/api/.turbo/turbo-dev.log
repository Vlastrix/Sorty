
> @sorty/api@0.1.0 dev C:\Vladi\Taller V Projects\Sorty\apps\api
> pnpm test:coverage && tsx watch src/index.ts


> @sorty/api@0.1.0 test:coverage C:\Vladi\Taller V Projects\Sorty\apps\api
> vitest run --coverage --reporter=verbose


[1m[46m RUN [49m[22m [36mv3.2.4 [39m[90mC:/Vladi/Taller V Projects/Sorty/apps/api[39m
      [2mCoverage enabled with [22m[33mv8[39m

 [32m‚úì[39m src/test/movements/movementService.test.ts[2m > [22mMovementService[2m > [22mregisterEntry[2m > [22mshould register an entry movement[32m 6[2mms[22m[39m
 [32m‚úì[39m src/test/movements/movementService.test.ts[2m > [22mMovementService[2m > [22mregisterEntry[2m > [22mshould use current date if not provided[32m 1[2mms[22m[39m
 [32m‚úì[39m src/test/movements/movementService.test.ts[2m > [22mMovementService[2m > [22mregisterExit[2m > [22mshould register an exit movement[32m 1[2mms[22m[39m
 [32m‚úì[39m src/test/movements/movementService.test.ts[2m > [22mMovementService[2m > [22mgetMovementHistory[2m > [22mshould return all movements[32m 1[2mms[22m[39m
 [32m‚úì[39m src/test/movements/movementService.test.ts[2m > [22mMovementService[2m > [22mgetMovementHistory[2m > [22mshould filter by movement type[32m 4[2mms[22m[39m
 [32m‚úì[39m src/test/movements/movementService.test.ts[2m > [22mMovementService[2m > [22mgetMovementHistory[2m > [22mshould filter by asset[32m 1[2mms[22m[39m
 [32m‚úì[39m src/test/movements/movementService.test.ts[2m > [22mMovementService[2m > [22mgetMovementById[2m > [22mshould return movement by id[32m 2[2mms[22m[39m
 [32m‚úì[39m src/test/movements/movementService.test.ts[2m > [22mMovementService[2m > [22mgetMovementById[2m > [22mshould return null when movement not found[32m 0[2mms[22m[39m
 [32m‚úì[39m src/test/auth/service.test.ts[2m > [22mAuthService[2m > [22mregisterUser[2m > [22mshould register a new user successfully[32m 9[2mms[22m[39m
 [32m‚úì[39m src/test/auth/service.test.ts[2m > [22mAuthService[2m > [22mregisterUser[2m > [22mshould throw error when user already exists[32m 3[2mms[22m[39m
 [32m‚úì[39m src/test/auth/service.test.ts[2m > [22mAuthService[2m > [22mregisterUser[2m > [22mshould handle argon2 hash errors[32m 1[2mms[22m[39m
 [32m‚úì[39m src/test/auth/service.test.ts[2m > [22mAuthService[2m > [22mregisterUser[2m > [22mshould handle database creation errors[32m 1[2mms[22m[39m
 [32m‚úì[39m src/test/auth/service.test.ts[2m > [22mAuthService[2m > [22mregisterUser[2m > [22mshould use default role "user" when not specified[32m 1[2mms[22m[39m
 [32m‚úì[39m src/test/auth/service.test.ts[2m > [22mAuthService[2m > [22mloginUser[2m > [22mshould login successfully with correct credentials[32m 1[2mms[22m[39m
 [32m‚úì[39m src/test/auth/service.test.ts[2m > [22mAuthService[2m > [22mloginUser[2m > [22mshould throw error when user does not exist[32m 1[2mms[22m[39m
 [32m‚úì[39m src/test/auth/service.test.ts[2m > [22mAuthService[2m > [22mloginUser[2m > [22mshould throw error when password is incorrect[32m 1[2mms[22m[39m
 [32m‚úì[39m src/test/auth/service.test.ts[2m > [22mAuthService[2m > [22mloginUser[2m > [22mshould handle argon2 verification errors[32m 1[2mms[22m[39m
 [32m‚úì[39m src/test/auth/service.test.ts[2m > [22mAuthService[2m > [22mloginUser[2m > [22mshould handle database query errors[32m 1[2mms[22m[39m
 [32m‚úì[39m src/test/auth/service.test.ts[2m > [22mAuthService[2m > [22mSecurity Tests[2m > [22mshould not return password in register response[32m 2[2mms[22m[39m
 [32m‚úì[39m src/test/auth/service.test.ts[2m > [22mAuthService[2m > [22mSecurity Tests[2m > [22mshould not return password in login response[32m 1[2mms[22m[39m
 [32m‚úì[39m src/test/incidents/incidentService.test.ts[2m > [22mIncidentService[2m > [22mreportIncident[2m > [22mshould create a new incident[32m 6[2mms[22m[39m
 [32m‚úì[39m src/test/incidents/incidentService.test.ts[2m > [22mIncidentService[2m > [22mgetIncidentHistory[2m > [22mshould return all incidents[32m 1[2mms[22m[39m
 [32m‚úì[39m src/test/incidents/incidentService.test.ts[2m > [22mIncidentService[2m > [22mgetIncidentHistory[2m > [22mshould filter by status[32m 5[2mms[22m[39m
 [32m‚úì[39m src/test/incidents/incidentService.test.ts[2m > [22mIncidentService[2m > [22mgetIncidentHistory[2m > [22mshould filter by type[32m 1[2mms[22m[39m
 [32m‚úì[39m src/test/incidents/incidentService.test.ts[2m > [22mIncidentService[2m > [22mgetIncidentHistory[2m > [22mshould filter by asset[32m 1[2mms[22m[39m
 [32m‚úì[39m src/test/incidents/incidentService.test.ts[2m > [22mIncidentService[2m > [22mresolveIncident[2m > [22mshould resolve incident record[32m 1[2mms[22m[39m
 [32m‚úì[39m src/test/incidents/incidentService.test.ts[2m > [22mIncidentService[2m > [22mgetIncidentById[2m > [22mshould return incident by id[32m 2[2mms[22m[39m
 [32m‚úì[39m src/test/incidents/incidentService.test.ts[2m > [22mIncidentService[2m > [22mgetIncidentsByAsset[2m > [22mshould return incidents for specific asset[32m 1[2mms[22m[39m
 [32m‚úì[39m src/test/incidents/incidentService.test.ts[2m > [22mIncidentService[2m > [22mcloseIncident[2m > [22mshould close a resolved incident[32m 2[2mms[22m[39m
 [32m‚úì[39m src/test/assets/categoryService.test.ts[2m > [22mCategoryService[2m > [22mgetAllCategories[2m > [22mshould return all categories with subcategories[32m 7[2mms[22m[39m
 [32m‚úì[39m src/test/assets/categoryService.test.ts[2m > [22mCategoryService[2m > [22mgetAllCategories[2m > [22mshould handle empty categories list[32m 1[2mms[22m[39m
 [32m‚úì[39m src/test/assets/categoryService.test.ts[2m > [22mCategoryService[2m > [22mgetAllCategories[2m > [22mshould handle database errors[32m 3[2mms[22m[39m
 [32m‚úì[39m src/test/assets/categoryService.test.ts[2m > [22mCategoryService[2m > [22mgetCategoryById[2m > [22mshould return category by id[32m 4[2mms[22m[39m
 [32m‚úì[39m src/test/assets/categoryService.test.ts[2m > [22mCategoryService[2m > [22mgetCategoryById[2m > [22mshould throw error when category not found[32m 1[2mms[22m[39m
 [32m‚úì[39m src/test/assets/categoryService.test.ts[2m > [22mCategoryService[2m > [22mcreateCategory[2m > [22mshould create a new category[32m 1[2mms[22m[39m
 [32m‚úì[39m src/test/assets/categoryService.test.ts[2m > [22mCategoryService[2m > [22mcreateCategory[2m > [22mshould create category with parentId[32m 1[2mms[22m[39m
 [32m‚úì[39m src/test/assets/categoryService.test.ts[2m > [22mCategoryService[2m > [22mupdateCategory[2m > [22mshould update an existing category[32m 1[2mms[22m[39m
 [32m‚úì[39m src/test/assets/categoryService.test.ts[2m > [22mCategoryService[2m > [22mupdateCategory[2m > [22mshould handle update errors[32m 1[2mms[22m[39m
 [32m‚úì[39m src/test/assets/categoryService.test.ts[2m > [22mCategoryService[2m > [22mdeleteCategory[2m > [22mshould delete category without subcategories[32m 3[2mms[22m[39m
 [32m‚úì[39m src/test/assets/categoryService.test.ts[2m > [22mCategoryService[2m > [22mdeleteCategory[2m > [22mshould not delete category with subcategories[32m 3[2mms[22m[39m
 [32m‚úì[39m src/test/assets/categoryService.test.ts[2m > [22mCategoryService[2m > [22mdeleteCategory[2m > [22mshould throw error when category not found[32m 1[2mms[22m[39m
 [32m‚úì[39m src/test/maintenance/maintenanceService.test.ts[2m > [22mMaintenanceService[2m > [22mscheduleMaintenance[2m > [22mshould create a new maintenance record[32m 6[2mms[22m[39m
 [32m‚úì[39m src/test/maintenance/maintenanceService.test.ts[2m > [22mMaintenanceService[2m > [22mgetMaintenanceHistory[2m > [22mshould return all maintenance records[32m 1[2mms[22m[39m
 [32m‚úì[39m src/test/maintenance/maintenanceService.test.ts[2m > [22mMaintenanceService[2m > [22mgetMaintenanceHistory[2m > [22mshould filter by status[32m 5[2mms[22m[39m
 [32m‚úì[39m src/test/maintenance/maintenanceService.test.ts[2m > [22mMaintenanceService[2m > [22mgetMaintenanceHistory[2m > [22mshould filter by asset[32m 1[2mms[22m[39m
 [32m‚úì[39m src/test/maintenance/maintenanceService.test.ts[2m > [22mMaintenanceService[2m > [22mgetMaintenanceHistory[2m > [22mshould filter by type[32m 1[2mms[22m[39m
 [32m‚úì[39m src/test/maintenance/maintenanceService.test.ts[2m > [22mMaintenanceService[2m > [22mcompleteMaintenance[2m > [22mshould complete maintenance record[32m 1[2mms[22m[39m
 [32m‚úì[39m src/test/maintenance/maintenanceService.test.ts[2m > [22mMaintenanceService[2m > [22mgetMaintenanceById[2m > [22mshould return maintenance record by id[32m 1[2mms[22m[39m
 [32m‚úì[39m src/test/maintenance/maintenanceService.test.ts[2m > [22mMaintenanceService[2m > [22mgetMaintenanceById[2m > [22mshould return null when maintenance not found[32m 1[2mms[22m[39m
 [32m‚úì[39m src/test/maintenance/maintenanceService.test.ts[2m > [22mMaintenanceService[2m > [22mcancelMaintenance[2m > [22mshould cancel a scheduled maintenance[32m 2[2mms[22m[39m
 [32m‚úì[39m src/test/maintenance/maintenanceService.test.ts[2m > [22mMaintenanceService[2m > [22mcancelMaintenance[2m > [22mshould throw error when cancelling completed maintenance[32m 5[2mms[22m[39m
 [32m‚úì[39m src/test/maintenance/maintenanceService.test.ts[2m > [22mMaintenanceService[2m > [22mstartMaintenance[2m > [22mshould start a scheduled maintenance[32m 1[2mms[22m[39m
 [32m‚úì[39m src/test/maintenance/maintenanceService.test.ts[2m > [22mMaintenanceService[2m > [22mstartMaintenance[2m > [22mshould throw error when starting non-scheduled maintenance[32m 4[2mms[22m[39m
 [32m‚úì[39m src/test/assignments/assignmentService.test.ts[2m > [22mAssignmentService[2m > [22massignAsset[2m > [22mshould create a new assignment successfully[32m 6[2mms[22m[39m
 [32m‚úì[39m src/test/assignments/assignmentService.test.ts[2m > [22mAssignmentService[2m > [22massignAsset[2m > [22mshould throw error when asset not found[32m 3[2mms[22m[39m
 [32m‚úì[39m src/test/assignments/assignmentService.test.ts[2m > [22mAssignmentService[2m > [22massignAsset[2m > [22mshould throw error when asset has active assignment[32m 1[2mms[22m[39m
 [32m‚úì[39m src/test/assignments/assignmentService.test.ts[2m > [22mAssignmentService[2m > [22mgetAssignmentHistory[2m > [22mshould return all assignments[32m 1[2mms[22m[39m
 [32m‚úì[39m src/test/assignments/assignmentService.test.ts[2m > [22mAssignmentService[2m > [22mgetAssignmentHistory[2m > [22mshould filter by status[32m 6[2mms[22m[39m
 [32m‚úì[39m src/test/assignments/assignmentService.test.ts[2m > [22mAssignmentService[2m > [22mgetAssignmentHistory[2m > [22mshould filter by assetId[32m 1[2mms[22m[39m
 [32m‚úì[39m src/test/assignments/assignmentService.test.ts[2m > [22mAssignmentService[2m > [22mreturnAsset[2m > [22mshould return an assignment successfully[32m 1[2mms[22m[39m
 [32m‚úì[39m src/test/assignments/assignmentService.test.ts[2m > [22mAssignmentService[2m > [22mreturnAsset[2m > [22mshould throw error when no active assignment found[32m 1[2mms[22m[39m
 [32m‚úì[39m src/test/assignments/assignmentService.test.ts[2m > [22mAssignmentService[2m > [22massignAsset edge cases[2m > [22mshould throw error when user is inactive[32m 1[2mms[22m[39m
 [32m‚úì[39m src/test/assignments/assignmentService.test.ts[2m > [22mAssignmentService[2m > [22massignAsset edge cases[2m > [22mshould throw error when user not found for assignment[32m 1[2mms[22m[39m
 [32m‚úì[39m src/test/assignments/assignmentService.test.ts[2m > [22mAssignmentService[2m > [22mtransferAsset[2m > [22mshould transfer asset to new user[32m 3[2mms[22m[39m
 [32m‚úì[39m src/test/assignments/assignmentService.test.ts[2m > [22mAssignmentService[2m > [22mtransferAsset[2m > [22mshould throw error when no active assignment for transfer[32m 1[2mms[22m[39m
 [32m‚úì[39m src/test/assignments/assignmentService.test.ts[2m > [22mAssignmentService[2m > [22mtransferAsset[2m > [22mshould throw error when new user is same as current[32m 1[2mms[22m[39m
 [32m‚úì[39m src/test/assignments/assignmentService.test.ts[2m > [22mAssignmentService[2m > [22mgetActiveAssignments[2m > [22mshould return only active assignments[32m 1[2mms[22m[39m
 [32m‚úì[39m src/test/assignments/assignmentService.test.ts[2m > [22mAssignmentService[2m > [22mgetAssignmentById[2m > [22mshould return assignment by id[32m 2[2mms[22m[39m
 [32m‚úì[39m src/test/assets/assetService.test.ts[2m > [22mAssetService[2m > [22mgetAssets[2m > [22mshould return paginated assets[32m 6[2mms[22m[39m
 [32m‚úì[39m src/test/assets/assetService.test.ts[2m > [22mAssetService[2m > [22mgetAssets[2m > [22mshould filter assets by status[32m 4[2mms[22m[39m
 [32m‚úì[39m src/test/assets/assetService.test.ts[2m > [22mAssetService[2m > [22mgetAssets[2m > [22mshould filter assets by category[32m 1[2mms[22m[39m
 [32m‚úì[39m src/test/assets/assetService.test.ts[2m > [22mAssetService[2m > [22mgetAssetById[2m > [22mshould return asset by id for admin[32m 1[2mms[22m[39m
 [32m‚úì[39m src/test/assets/assetService.test.ts[2m > [22mAssetService[2m > [22mgetAssetById[2m > [22mshould throw error when asset not found[32m 4[2mms[22m[39m
 [32m‚úì[39m src/test/assets/assetService.test.ts[2m > [22mAssetService[2m > [22mcreateAsset[2m > [22mshould create a new asset[32m 2[2mms[22m[39m
 [32m‚úì[39m src/test/assets/assetService.test.ts[2m > [22mAssetService[2m > [22mcreateAsset[2m > [22mshould throw error when code already exists[32m 1[2mms[22m[39m
 [32m‚úì[39m src/test/assets/assetService.test.ts[2m > [22mAssetService[2m > [22mupdateAsset[2m > [22mshould update an existing asset[32m 2[2mms[22m[39m
 [32m‚úì[39m src/test/assets/assetService.test.ts[2m > [22mAssetService[2m > [22mdeleteAsset[2m > [22mshould delete an asset[32m 2[2mms[22m[39m
 [32m‚úì[39m src/test/assets/assetService.test.ts[2m > [22mAssetService[2m > [22mgetAssetStats[2m > [22mshould return asset statistics[32m 1[2mms[22m[39m
 [32m‚úì[39m src/test/assets/assetService.test.ts[2m > [22mAssetService[2m > [22mgetAssetByCode[2m > [22mshould return asset by code[32m 1[2mms[22m[39m
 [32m‚úì[39m src/test/assets/assetService.test.ts[2m > [22mAssetService[2m > [22massignAsset[2m > [22mshould assign asset to user[32m 1[2mms[22m[39m
 [32m‚úì[39m src/test/assets/assetService.test.ts[2m > [22mAssetService[2m > [22massignAsset[2m > [22mshould throw error when user is inactive[32m 1[2mms[22m[39m

[2m Test Files [22m [1m[32m7 passed[39m[22m[90m (7)[39m
[2m      Tests [22m [1m[32m81 passed[39m[22m[90m (81)[39m
[2m   Start at [22m 21:18:25
[2m   Duration [22m 1.47s[2m (transform 587ms, setup 940ms, collect 1.01s, tests 192ms, environment 4ms, prepare 2.20s)[22m

[34m % [39m[2mCoverage report from [22m[33mv8[39m
-------------------|---------|----------|---------|---------|-------------------
File               | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s 
-------------------|---------|----------|---------|---------|-------------------
All files          |   41.85 |    59.23 |   63.79 |   41.85 |                   
 assets            |   48.98 |    58.33 |    61.9 |   48.98 |                   
  assetService.ts  |   56.74 |       50 |   66.66 |   56.74 | ...17-418,425-444 
  ...oryService.ts |   63.74 |    73.68 |    62.5 |   63.74 | ...88-194,201-211 
  schemas.ts       |       0 |        0 |       0 |       0 | 1-109             
 assignments       |   96.73 |    68.08 |      75 |   96.73 |                   
  ...entService.ts |   96.73 |    68.08 |      75 |   96.73 | ...54-455,461-462 
 auth              |    9.19 |       70 |   28.57 |    9.19 |                   
  jwt.ts           |       0 |        0 |       0 |       0 | 1-32              
  middleware.ts    |       0 |        0 |       0 |       0 | 1-103             
  roles.ts         |       0 |        0 |       0 |       0 | 1-164             
  schemas.ts       |       0 |        0 |       0 |       0 | 1-17              
  service.ts       |   96.96 |    93.33 |     100 |   96.96 | 64-65             
  userService.ts   |       0 |        0 |       0 |       0 | 1-314             
 incidents         |   65.64 |       50 |      75 |   65.64 |                   
  ...entService.ts |   65.64 |       50 |      75 |   65.64 | ...27-234,269-302 
 maintenance       |   69.28 |    53.84 |      75 |   69.28 |                   
  ...nceService.ts |   69.28 |    53.84 |      75 |   69.28 | ...30-237,272-335 
 movements         |   71.91 |       50 |      80 |   71.91 |                   
  ...entService.ts |   71.91 |       50 |      80 |   71.91 | ...59-166,201-218 
 reports           |       0 |        0 |       0 |       0 |                   
  service.ts       |       0 |        0 |       0 |       0 | 1-501             
-------------------|---------|----------|---------|---------|-------------------

=============================== Coverage summary ===============================
Statements   : 41.85% ( 1220/2915 )
Branches     : 59.23% ( 109/184 )
Functions    : 63.79% ( 37/58 )
Lines        : 41.85% ( 1220/2915 )
================================================================================
API corriendo en http://localhost:4000
Sistema de Gesti√≥n de Activos:
   Auth: /auth/login, /auth/register
   Usuarios: /users (CRUD, roles)
   Categor√≠as: /categories
   Activos: /assets
   Asignaciones: /assignments (historial y control)
   Movimientos: /movements (entradas/salidas)
   Mantenimientos: /maintenance (preventivo/correctivo)
